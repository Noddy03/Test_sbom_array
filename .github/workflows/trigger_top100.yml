name: SBOM Collection & Trigger Main

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  fetch-and-collect:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout the repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Set up GitHub CLI
      - name: Set up GitHub CLI
        uses: cli/gh-actions/setup-gh@v2

      # Step 3: Authenticate with your token
      - name: Authenticate with GH token
        run: gh auth login --with-token <<< "${{ secrets.MY_GH_TOKEN }}"

      # Step 4: Fetch SBOM dependencies or any needed files
      - name: Fetch dependencies / files
        run: |
          echo "Fetching necessary SBOM dependencies..."
          # Example: curl or gh commands to fetch assets if needed
          # curl -O https://example.com/dependency

      # Step 5: Generate SBOM
      - name: Generate SBOM
        run: |
          echo "Generating SBOM..."
          # Your SBOM generation commands, e.g.:
          # syft packages dir:. -o json > sbom.json

      # Step 6: Commit or upload SBOM
      - name: Upload SBOM artifact
        uses: actions/upload-artifact@v3
        with:
          name: sbom
          path: sbom.json

      # Step 7: Trigger the main workflow
      - name: Trigger main workflow
        run: |
          echo "Triggering main workflow..."
          gh workflow run main.yml -f sbom_path=sbom.json
